<%= form_for(@mission) do |f| %>
  <% if @mission.errors.any? %>
    <div id="error_explanation">
      <h2><%= pluralize(@mission.errors.count, "error") %> prohibited this mission from being saved:</h2>

      <ul>
      <% @mission.errors.full_messages.each do |msg| %>
        <li><%= msg %></li>
      <% end %>
      </ul>
    </div>
  <% end %>

  <div class="form-group">
    <%= f.label :company %><br />
    <%= select_tag :company, options_for_select(Company.all.map { |c| [c.name, c.id] }), :class => "form-control" %>
  </div>

  <div class="form-group">
    <%= f.label :name %><br />
    <%= f.text_field :name, :class => "form-control" %>
  </div>

  <div class="form-group">
    <%= f.label :description %><br /><br />
    <div class="btn-toolbar" data-role="editor-toolbar" data-target="#editor">
      <div class="btn-group">
        <a data-original-title="Font" class="btn btn-default dropdown-toggle" data-toggle="dropdown" title="">
          <i class="fa fa-font"></i><b class="caret"></b>
        </a>
        <ul class="dropdown-menu">
          <li><a data-edit="fontName Serif" style="font-family:\'Serif\'">Serif</a></li>
          <li><a data-edit="fontName Sans" style="font-family:\'Sans\'">Sans</a></li>
          <li><a data-edit="fontName Arial" style="font-family:\'Arial\'">Arial</a></li>
          <li><a data-edit="fontName Arial Black" style="font-family:\'Arial Black\'">Arial Black</a></li>
          <li><a data-edit="fontName Courier" style="font-family:\'Courier\'">Courier</a></li>
          <li><a data-edit="fontName Courier New" style="font-family:\'Courier New\'">Courier New</a></li>
          <li><a data-edit="fontName Comic Sans MS" style="font-family:\'Comic Sans MS\'">Comic Sans MS</a></li>
          <li><a data-edit="fontName Helvetica" style="font-family:\'Helvetica\'">Helvetica</a></li>
          <li><a data-edit="fontName Impact" style="font-family:\'Impact\'">Impact</a></li>
          <li><a data-edit="fontName Lucida Grande" style="font-family:\'Lucida Grande\'">Lucida Grande</a></li>
          <li><a data-edit="fontName Lucida Sans" style="font-family:\'Lucida Sans\'">Lucida Sans</a></li><li><a data-edit="fontName Tahoma" style="font-family:\'Tahoma\'">Tahoma</a></li>
          <li><a data-edit="fontName Times" style="font-family:\'Times\'">Times</a></li>
          <li><a data-edit="fontName Times New Roman" style="font-family:\'Times New Roman\'">Times New Roman</a></li>
          <li><a data-edit="fontName Verdana" style="font-family:\'Verdana\'">Verdana</a></li>
        </ul>
      </div>
      <div class="btn-group">
        <a data-original-title="Font Size" class="btn btn-default dropdown-toggle" data-toggle="dropdown" title="">
          <i class="fa fa-text-height"></i>&nbsp;<b class="caret"></b>
        </a>
        <ul class="dropdown-menu">
          <li><a data-edit="fontSize 5"><font size="5">Huge</font></a></li>
          <li><a data-edit="fontSize 3"><font size="3">Normal</font></a></li>
          <li><a data-edit="fontSize 1"><font size="1">Small</font></a></li>
        </ul>
      </div>
      <div class="btn-group">
        <a data-original-title="Bold (Ctrl/Cmd+B)" class="btn btn-default" data-edit="bold" title="">
          <i class="fa fa-bold"></i>
        </a>
        <a data-original-title="Italic (Ctrl/Cmd+I)" class="btn btn-default" data-edit="italic" title="">
          <i class="fa fa-italic"></i>
        </a>
        <a data-original-title="Strikethrough" class="btn btn-default" data-edit="strikethrough" title="">
          <i class="fa fa-strikethrough"></i>
        </a>
        <a data-original-title="Underline (Ctrl/Cmd+U)" class="btn btn-default" data-edit="underline" title="">
          <i class="fa fa-underline"></i>
        </a>
      </div>
      <div class="btn-group">
        <a data-original-title="Bullet list" class="btn btn-default" data-edit="insertunorderedlist" title="">
          <i class="fa fa-list-ul"></i>
        </a>
        <a data-original-title="Number list" class="btn btn-default" data-edit="insertorderedlist" title="">
          <i class="fa fa-list-ol"></i>
        </a>
        <a data-original-title="Reduce indent (Shift+Tab)" class="btn btn-default" data-edit="outdent" title="">
          <i class="fa fa-outdent"></i>
        </a>
        <a data-original-title="Indent (Tab)" class="btn btn-default" data-edit="indent" title="">
          <i class="fa fa-indent"></i>
        </a>
      </div>
      <div class="btn-group">
        <a data-original-title="Align Left (Ctrl/Cmd+L)" class="btn btn-default" data-edit="justifyleft" title="">
          <i class="fa fa-align-left"></i>
        </a>
        <a data-original-title="Center (Ctrl/Cmd+E)" class="btn btn-default" data-edit="justifycenter" title="">
          <i class="fa fa-align-center"></i>
        </a>
        <a data-original-title="Align Right (Ctrl/Cmd+R)" class="btn btn-default" data-edit="justifyright" title="">
          <i class="fa fa-align-right"></i>
        </a>
        <a data-original-title="Justify (Ctrl/Cmd+J)" class="btn btn-default" data-edit="justifyfull" title="">
          <i class="fa fa-align-justify"></i>
        </a>
      </div>
      <div class="btn-group">
        <a data-original-title="Hyperlink" class="btn btn-default dropdown-toggle" data-toggle="dropdown" title="">
          <i class="fa fa-link"></i>
        </a>
        <div class="dropdown-menu input-append">
          <input class="span2" placeholder="URL" data-edit="createLink" type="text">
          <button class="btn btn-default" type="button">Add</button>
        </div>
      </div>
      <div class="btn-group">
        <a data-original-title="Insert picture (or just drag &amp; drop)" class="btn btn-default" title="" id="pictureBtn">
          <i class="fa fa-picture-o"></i>
        </a>
        <a class="btn btn-default">
          <i class="fa fa-paperclip"></i>
        </a>
        <input style="opacity: 0; position: absolute; top: 0px; left: 0px; width: 41px; height: 34px;" data-role="magic-overlay" data-target="#pictureBtn" data-edit="insertImage" type="file">
      </div>
      <div class="btn-group">
        <a data-original-title="Undo (Ctrl/Cmd+Z)" class="btn btn-default" data-edit="undo" title="">
          <i class="fa fa-undo"></i>
        </a>
        <a data-original-title="Redo (Ctrl/Cmd+Y)" class="btn btn-default" data-edit="redo" title="">
          <i class="fa fa-repeat"></i>
        </a>
      </div>
      <input style="display: none;" data-edit="inserttext" id="voiceBtn" x-webkit-speech="" type="text">
    </div><br />

    <div id="editor" class="editor form-control" contenteditable="true" style="min-height:100px;height:100%; text-align:left">
      <%=raw @mission.description %>
    </div><br />
  </div>
  <div class="actions">
    <button id="create" class="btn btn-primary">Create</button>
  </div>
<% end %>

<script>
  $(document).ready(function() {
    $('#editor').wysiwyg();

    $('#create').on('click', function(e) {
      e.preventDefault();
      jQuery.ajax({
        type: 'POST',
        url: '/missions',
        data:
        {
          'id': <%= @mission.id %>,
          'company_id': $("#company").val(),
          'mission[name]': $('#mission_name').val(),
          'mission[description]': $("#editor").html(),
          'authenticity_token' : $('authenticity_token').val()
        },
        success: function(data, textStatus, jqXHR)
        {
          if(data['error']) {
            alert(data['error']);
          } else {
            document.location = '/missions';
          }
        }
      });
    });
  });
</script>